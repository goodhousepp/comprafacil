<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>CompraFÃ¡cil</title>

<style>
:root{
  --bg1:#0d1b2a;
  --bg2:#16283f;
  --text:#ffffff;
  --muted:#cbd5e1;
  --primary:#2563eb;
  --danger:#ef4444;
  --ok:#22c55e;
  --radius:14px;
  --card:rgba(255,255,255,.06);
  --line:rgba(255,255,255,.12);
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui;
  background:linear-gradient(180deg,var(--bg1),var(--bg2));
  color:var(--text);
}
.wrap{
  max-width:760px;
  margin:auto;
  padding:16px;
  padding-bottom:300px;
}
h1{
  margin:0 0 12px;
  font-size:22px;
}
button,input,select{
  font-size:16px;
  border-radius:var(--radius);
  padding:12px;
  border:none;
  width:100%;
}
input,select{
  background:var(--card);
  color:white;
  border:1px solid var(--line);
}
button{
  background:var(--card);
  color:white;
  border:1px solid var(--line);
}
button:active{transform:scale(.98)}
.addBtn{
  background:var(--primary);
  border:none;
  font-weight:bold;
}
.filters{
  display:flex;
  gap:8px;
  margin-bottom:12px;
}
.filters button{flex:1}
.filters .active{
  background:rgba(37,99,235,.4);
}
.section{
  border:1px solid var(--line);
  border-radius:14px;
  margin-top:10px;
  overflow:hidden;
}
.sectionHeader{
  padding:10px;
  font-weight:bold;
  background:rgba(255,255,255,.05);
}
.items{
  padding:10px;
  display:flex;
  flex-direction:column;
  gap:8px;
}
.item{
  display:flex;
  align-items:center;
  gap:8px;
  background:rgba(255,255,255,.06);
  padding:8px;
  border-radius:10px;
}
.name{flex:1}
.done .name{text-decoration:line-through;opacity:.6}
.bottomBar{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  background:rgba(13,27,42,.95);
  padding:12px;
  border-top:1px solid var(--line);
}
.gridInput{
  display:grid;
  grid-template-columns:1fr 80px;
  gap:8px;
}
.gridInput select{grid-column:1/-1}
.gridInput button{grid-column:1/-1}
.acWrap{position:relative}
.acList{
  position:absolute;
  top:100%;
  left:0;
  right:0;
  background:#0d1b2a;
  border:1px solid var(--line);
  border-radius:10px;
  max-height:240px;
  overflow:auto;
  display:none;
  z-index:20;
}
.acItem{
  padding:10px;
  border-bottom:1px solid rgba(255,255,255,.08);
}
.acItem:last-child{border-bottom:none}
.acItem:hover{background:rgba(255,255,255,.06)}
</style>
</head>

<body>
<div class="wrap">
<h1>ðŸ›’ CompraFÃ¡cil</h1>

<div class="filters">
<button id="fAll" class="active">Todos</button>
<button id="fTodo">Pendentes</button>
<button id="fDone">Comprados</button>
</div>

<input id="searchList" placeholder="Buscar na lista">

<div id="sections"></div>
</div>

<div class="bottomBar">
<div class="gridInput">

<div class="acWrap">
<input id="product" placeholder="Produto (ex: maio â†’ Maionese)" autocomplete="off">
<div id="acList" class="acList"></div>
</div>

<input id="qty" placeholder="Qtd" inputmode="numeric">

<select id="category">
<option>Hortifruti</option>
<option>Padaria/Matinais</option>
<option>Carnes</option>
<option>LaticÃ­nios</option>
<option>Mercearia</option>
<option>Bebidas</option>
<option>Limpeza</option>
<option>Higiene</option>
<option>Outros</option>
</select>

<button class="addBtn" id="addBtn">Adicionar</button>
</div>
</div>

<script src="catalogo.js"></script>

<script>
// ===== CONFIG =====
const STORAGE="comprafacil_v15";
const CATS=["Hortifruti","Padaria/Matinais","Carnes","LaticÃ­nios","Mercearia","Bebidas","Limpeza","Higiene","Outros"];
const CATALOG = window.CATALOG || {};

let items = JSON.parse(localStorage.getItem(STORAGE))||[];
let filter="all";
let textSearch="";

const $=(id)=>document.getElementById(id);
function save(){localStorage.setItem(STORAGE,JSON.stringify(items))}

function normalize(s){
return (s||"").toLowerCase()
.normalize("NFD").replace(/[\u0300-\u036f]/g,"");
}

// ===== AUTOCOMPLETE =====
const FLAT=[];
for(const cat in CATALOG){
for(const name of CATALOG[cat]){
FLAT.push({name,cat});
}
}

function showAC(list){
const box=$("acList");
box.innerHTML="";
if(!list.length){box.style.display="none";return;}
for(const it of list){
const d=document.createElement("div");
d.className="acItem";
d.textContent=it.name+" â€” "+it.cat;
d.onclick=()=>{
$("product").value=it.name;
$("category").value=it.cat;
box.style.display="none";
$("qty").focus();
};
box.appendChild(d);
}
box.style.display="block";
}

$("product").addEventListener("input",()=>{
const q=normalize($("product").value);
if(q.length<2){showAC([]);return;}
const found=[];
for(const it of FLAT){
if(normalize(it.name).includes(q)){
found.push(it);
if(found.length>=12)break;
}
}
showAC(found);
});

document.addEventListener("click",(e)=>{
if(!e.target.closest(".acWrap"))$("acList").style.display="none";
});

// ===== ADD ITEM =====
$("addBtn").onclick=()=>{
const name=$("product").value.trim();
const qty=$("qty").value.trim()||"1";
const cat=$("category").value;
if(!name)return;
items.unshift({name,qty,cat,done:false});
save();
$("product").value="";
$("qty").value="";
render();
};

// ===== RENDER =====
function render(){
const sec=$("sections");
sec.innerHTML="";
let view=[...items];
if(filter==="todo")view=view.filter(i=>!i.done);
if(filter==="done")view=view.filter(i=>i.done);
if(textSearch)view=view.filter(i=>normalize(i.name).includes(normalize(textSearch)));

for(const cat of CATS){
const arr=view.filter(i=>i.cat===cat);
if(!arr.length)continue;
const section=document.createElement("div");
section.className="section";
const head=document.createElement("div");
head.className="sectionHeader";
head.textContent=cat;
section.appendChild(head);
const box=document.createElement("div");
box.className="items";
for(const item of arr){
const row=document.createElement("div");
row.className="item"+(item.done?" done":"");
const chk=document.createElement("input");
chk.type="checkbox";
chk.checked=item.done;
chk.onchange=()=>{item.done=chk.checked;save();render();}
const name=document.createElement("div");
name.className="name";
name.textContent=item.name+" ("+item.qty+")";
const del=document.createElement("button");
del.textContent="X";
del.onclick=()=>{items=items.filter(i=>i!==item);save();render();}
row.append(chk,name,del);
box.appendChild(row);
}
section.appendChild(box);
sec.appendChild(section);
}
}

// ===== FILTERS =====
$("fAll").onclick=()=>{filter="all";render()}
$("fTodo").onclick=()=>{filter="todo";render()}
$("fDone").onclick=()=>{filter="done";render()}
$("searchList").oninput=e=>{textSearch=e.target.value;render()}

// INIT
render();
</script>
</body>
</html>
